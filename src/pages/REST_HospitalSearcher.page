<apex:page id="REST_HospitalSearcher" lightningStyleSheets="true" controller="REST_HospitalSearcherController">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
    .hide-modal{
        display: none;
    }

    </style>
    <apex:slds/>
    <div class="slds-scope">
        <apex:form id="theForm">
            <div class="slds-page-header">
                <div class="slds-page-header__row">
                    <div class="slds-page-header__col-title">
                        <div class="slds-media">
                            <div class="slds-media__figure">
          <span class="slds-icon_container slds-icon-standard-household">
            <svg class="slds-icon slds-page-header__icon" aria-hidden="true">
              <use href="/apexpages/slds/latest/assets/icons/standard-sprite/svg/symbols.svg#household"></use>
            </svg>
          </span>
                            </div>
                            <div class="slds-media__body">
                                <div class="slds-page-header__name">
                                    <div class="slds-page-header__name-title">
                                        <h1>
                                            <span class="slds-page-header__title slds-truncate">Hospitals Manager</span>
                                        </h1>
                                    </div>
                                </div>
                                <p class="slds-page-header__name-meta">REST Integration</p>
                            </div>
                        </div>
                    </div>
                    <div class="slds-page-header__col-actions">
                        <div class="slds-page-header__controls">
                            <div class="slds-page-header__control">
                                <ul class="slds-button-group-list">
                                    <li>
                                        <apex:commandButton styleClass="slds-button slds-button--neutral" immediate="true"
                                                            value="{!$Label.New}" action="{!clearHospital}"
                                                            onClick="openAddHospitalModal();" reRender="editForm"
                                                            style="float: right; width: 120px;"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <apex:pageBlock id="hospitalSearcherPageBlock">
                <apex:pageBlockSection>
                    <apex:pageBlockSectionItem>
                        <apex:outputLabel value="{!$Label.Name}" for="name"/>
                        <apex:inputText styleClass="slds-input" id="name" value="{!hospital.Name}"
                                        style="width: 200px;"/>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem>
                        <apex:outputLabel value="{!$Label.Address}" for="address"/>
                        <apex:inputText styleClass="slds-input" id="address" value="{!hospital.Address__c}"
                                        style="width: 200px;"/>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
                <apex:pageBlockSection columns="2">
                    <apex:pageBlockSectionItem>
                        <apex:commandButton status="spinner" styleClass="slds-button slds-button--brand"
                                            action="{!searchHospitals}"
                                            value="{!$Label.Search}"
                                            rerender="theForm"
                                            style="float: right; width: 120px; margin: 10px 0;"/>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem>
                        <apex:actionRegion>
                            <apex:commandButton styleClass="slds-button slds-button--neutral" action="{!clearResults}"
                                                value="{!$Label.Clear}" status="spinner"
                                                disabled="{!IF(hospitals.size!=null, false, true)}"
                                                rerender="theForm" immediate="true"
                                                style="float: left; width: 120px; margin: 10px 0;"/>
                        </apex:actionRegion>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
                <apex:pageBlockSection>
                    <h1>
                        <span class="slds-page-header__title slds-truncate">
                                {!$Label.Hospitals}
                        </span>
                    </h1>
                    <p>Items: {!IF(hospitals.size!=null, hospitals.size, '0')}</p>
                    <p>{!IF(hospitals.size!=null,'', $Label.NoHospitalsToDisplay)}</p>
                </apex:pageBlockSection>
                <apex:pageBlockSection columns="1" id="hospitalsFound" rendered="{!IF(hospitals.size!=null, true, false)}">
                    <apex:pageBlockSectionItem>
                        <apex:pageBlockTable id="hospitalsRecords"
                                             styleClass="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped"
                                             value="{!hospitals}" var="hospitalRecord">
                            <apex:column style="width: 10%" headerValue="{!$Label.Action}">
                                <apex:commandLink onClick="openDeleteConfirmationModal();" value="{!$Label.Delete}"
                                                  rerender="theForm">
                                    <apex:param assignTo="{!hospitalIdToDelete}" name="hospitalIdToDelete"
                                                value="{!hospitalRecord.ExternalId__c}"/>
                                </apex:commandLink>
                                <apex:commandLink action="{!readHospitalRecord}" value="{!$Label.Update}"
                                                  onComplete="openHospitalUpdateModal();"
                                                  reRender="updateForm" style="margin-left: 10px;">
                                    <apex:param assignTo="{!hospitalToUpdate}"
                                                name="hospitalToUpdate"
                                                value="{!hospitalRecord.ExternalId__c}"/>
                                </apex:commandLink>
                            </apex:column>
                            <apex:column value="{!hospitalRecord.Name}"/>
                            <apex:column value="{!hospitalRecord.Address__c}"/>
                        </apex:pageBlockTable>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
            </apex:pageBlock>
            <apex:actionStatus id="spinner">
                <apex:facet name="start">
                    <div class="slds-spinner_container"
                         style="z-index: 100001; position: fixed; top: 0; left: 0; right: 0; bottom: 0;">
                        <div role="status" class="slds-spinner slds-spinner_medium">
                            <span class="slds-assistive-text">Loading</span>
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </div>
                </apex:facet>
            </apex:actionStatus>
        </apex:form>
    </div>
    <apex:outputPanel id="addHospitalPanel">
        <apex:include pageName="REST_CreateHospital" id="REST_CreateHospital"/>
    </apex:outputPanel>
    <apex:outputPanel id="updateHospitalPanel">
        <apex:include pageName="HOSP_SoapUpdateDoctor" id="HOSP_SoapUpdateDoctor"/>
    </apex:outputPanel>
    <apex:outputPanel id="deleteConfirmationPanel">
        <apex:form>
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                     class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate">{!$Label.DeleteHospital}</h1>
                    </div>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <p style="text-align: center">
                                {!$Label.DeleteConfirmation}
                        </p>
                    </div>
                    <div class="slds-modal__footer">
                        <apex:commandButton value="{!$Label.Cancel}" styleClass="slds-button slds-button_outline-brand"
                                            reRender="editForm" immediate="true"
                                            onClick="closeDeleteConfirmationModal(); return false;"/>
                        <apex:commandButton value="{!$Label.Delete}" styleClass="slds-button slds-button_brand"
                                            action="{!deleteHospital}" rerender="theForm" status="spinner"
                                            onComplete="closeDeleteConfirmationModal(); return false;"/>
                    </div>
                </div>
            </section>
        </apex:form>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </apex:outputPanel>
    <script>
        j$ = jQuery.noConflict();
        j$('[id$=addHospitalPanel]').addClass('hide-modal');
        j$('[id$=updateHospitalPanel]').addClass('hide-modal');
        j$('[id$=deleteConfirmationPanel]').addClass('hide-modal');

        function openAddHospitalModal() {
            j$('[id$=addHospitalPanel]').removeClass('hide-modal');
        }

        function closeAddHospitalModal(shouldCloseAddHospitalModal) {
            if(shouldCloseAddHospitalModal){
                j$('[id$=addHospitalPanel]').addClass('hide-modal');
            }
            console.log(shouldCloseAddHospitalModal);
        }

        function openHospitalUpdateModal() {
            j$('[id$=updateHospitalPanel]').removeClass('hide-modal');
        }

        function closeHospitalUpdateModal(shouldCloseUpdateHospitalModal) {
            if(shouldCloseUpdateHospitalModal){
                j$('[id$=updateHospitalPanel]').addClass('hide-modal');
            }
        }

        function openDeleteConfirmationModal() {
            j$('[id$=deleteConfirmationPanel]').removeClass('hide-modal');
        }

        function closeDeleteConfirmationModal() {
            j$('[id$=deleteConfirmationPanel]').addClass('hide-modal');
        }

    </script>
</apex:page>